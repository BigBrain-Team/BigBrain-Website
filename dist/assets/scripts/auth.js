var auth=null;!function(){firebase.initializeApp({apiKey:"AIzaSyC0yaoAE6qt1oEzHT4ueZZUrNFMN-3U8nE",authDomain:"bigbrain-c56d1.firebaseapp.com",databaseURL:"https://bigbrain-c56d1.firebaseio.com",projectId:"bigbrain-c56d1",storageBucket:"bigbrain-c56d1.appspot.com",messagingSenderId:"126863628981",appId:"1:126863628981:web:f777031fa40de4be37fcfc",measurementId:"G-7VYVV8F7ZH"}),firebase.analytics(),auth=firebase.auth();const e=firebase.firestore();function t(e){$("title").text(`BigBrain | Me (${e.displayName})`),$("#log").text(`Hello, ${e.displayName}.`);let t=e.photoURL;t||(t="https://www.searchpng.com/wp-content/uploads/2019/02/Men-Profile-Image-715x657.png"),$("#pfp").attr("src",t),$("#newname-field").attr("placeholder",e.displayName),$("#photourl-field").attr("placeholder","default")}auth.onAuthStateChanged(n=>{n?document.getElementById("me")?t(n):document.getElementById("navbar-title")?function(t){$("#navbar-title").text(t.displayName);const n=e.collection("users").doc(t.uid).collection("courseData").doc(getCourseID());n.get().then((function(e){e.exists?(finishedLessonsLocal=e.data().finishedLessons,finishedLessonsLocal.forEach(finishLesson)):(console.log("Creating database for user..."),n.set({finishedLessons:[]}).then((function(){console.log("Creation success!")})))})).catch((function(e){alert("Error: "+e)}))}(n):document.getElementById("login-form")?window.location.href="../me":($("#nav-btn").parent().parent().attr("href","/me"),$("#nav-btn").text("Account")):(document.getElementById("me")&&(window.location.href="/login"),(document.getElementById("app")||document.querySelector("main"))&&(window.location.href="/login"),document.getElementById("creator")&&(window.location.href="/login"))});const n=document.querySelector("#login-form");n&&n.addEventListener("submit",e=>{e.preventDefault();const t=n.email.value,o=n.pswd.value;auth.signInWithEmailAndPassword(t,o).catch(e=>{console.log(e);let t=e.message;const n=e.code;"auth/user-not-found"==n?t="Hmmm...looks like this user doesn't exist.":"auth/wrong-password"==n&&(t="Incorrect password."),$("#log").text(t)})});const o=document.querySelector("#signup-form");o&&o.addEventListener("submit",e=>{e.preventDefault();const t=o.email.value,n=o.pswd.value,a=o.name.value;auth.createUserWithEmailAndPassword(t,n).then(()=>{auth.currentUser.updateProfile({displayName:a}).then(()=>{window.location.href="/me"}).catch(e=>{$("#log").text(e.message),alert(e)})}).catch(e=>{console.log(e),$("#log").text(e.message)})}),document.querySelector("#logout")&&logout.addEventListener("click",()=>{auth.signOut().then(()=>{console.log("Signed Out!"),window.location.href="/"})});const a=document.querySelector("#name-change");a&&a.addEventListener("submit",e=>{e.preventDefault();const n=a["newname-field"].value;""!=n&&(n.length>=3?auth.currentUser.updateProfile({displayName:n}).then(()=>{console.log("Name changed success!"),t(auth.currentUser),a.reset(),window.location.href="#home"}).catch(e=>{$("#namechange-log").text(e.message)}):$("#namechange-log").text("At least three charachters."))});const s=document.querySelector("#pfp-change");s&&s.addEventListener("submit",e=>{e.preventDefault();let n=s["photourl-field"].value;""==n&&(n="https://www.searchpng.com/wp-content/uploads/2019/02/Men-Profile-Image-715x657.png"),auth.currentUser.updateProfile({photoURL:n}).then(()=>{console.log("Photo changed success!"),t(auth.currentUser),s.reset(),window.location.href="#home"}).catch(e=>{$("#photochange-log").text(e.message)})});const r=document.querySelector("#delete-account");r&&r.addEventListener("submit",e=>{e.preventDefault();const t=r["delete-field"].value;auth.signInWithEmailAndPassword(auth.currentUser.email,t).then(()=>{auth.currentUser.delete().catch(e=>{$("#delete-log").text(e.code)})}).catch(e=>{"auth/wrong-password"==e.code?$("delete-label").text("Incorrect password."):alert("Something went terribly wrong! Please report this to us:\n"+e)})})}();